<%- include('../header') %>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal</title>
    <link rel="stylesheet" href="/css/estilos2.css">

</head>
<body>
    <div class="main-content">
<main>


        <div class="busqueda">
            <div>
                <label for="buscar">Buscar Personal</label>
                <input type="text" id="buscar" placeholder="Buscar personal">

                <label for="especialidad">Tipo de Especialidad</label>
                <select id="especialidad">
                    <option value="">Seleccione la Especialidad</option>
                    <% especialidades.forEach(function(especialidad) { %>
                        <option value="<%= especialidad.Descripcion %>"><%= especialidad.Descripcion %></option>
                    <% }) %>
                </select>

               
            </div>
        </div>

        <div class="tabla-section">
            <div class="tabla-titulo">Personal registrado</div>
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Cédula</th>
                        <th>Edad</th>
                        <th>Genero</th>
                        <th>Ocupacion</th>
                        <th>Especialidad</th>
                        <th>Email</th>
                    </tr>
                </thead>
                <tbody id="tabla-personal">
                    <% personal.forEach(persona => { %>
                        <tr>
                            <td><input type="radio" name="personal_id" value="<%= persona.id %>"></td>
                            <td><%= persona.Nombre %></td>
                            <td><%= persona.Apellido %></td>
                            <td><%= persona.Cedula %></td>
                            <td><%= persona.Edad %></td>
                            <td><%= persona.Genero %></td>
                            <td><%= persona.Ocupacion %></td>
                            <td><%= persona.Especialidad %></td>
                            <td><%= persona.Email %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
            <div class="botones-personal">
                <button class="nuevo-personal" onclick="window.location.href='/registrarpersonal'">Nuevo</button>
                <button class="eliminar-personal" id="eliminar-personal" disabled>Eliminar</button>
                <button class="editar-personal" id="editar-personal" disabled>Editar</button>
            </div>
        </div>

    </main>
<script>
    let personalSeleccionado = null;
    
    function asignarListenersRadios() {
            const radios = document.getElementsByName('personal_id');
            radios.forEach(radio => {
                radio.addEventListener('change', function() {
                    personalSeleccionado = this.value;
                    document.getElementById('eliminar-personal').disabled = false;
                    document.getElementById('editar-personal').disabled = false;
                });
            });
        }
        // Inicializar los listeners de los radios al cargar la página
        asignarListenersRadios();

    function actualizarTabla(data) {
        const tbody = document.getElementById('tabla-personal');
        tbody.innerHTML = '';
        data.forEach(persona => {
            const fila = document.createElement('tr');
            fila.innerHTML = `
                <td><input type="radio" name="personal_id" value="${persona.id}"></td>
                <td>${persona.Nombre}</td>
                <td>${persona.Apellido}</td>
                <td>${persona.Cedula}</td>
                <td>${persona.Edad}</td>
                <td>${persona.Genero}</td>
                <td>${persona.Ocupacion}</td>
                <td>${persona.Especialidad}</td>
                <td>${persona.Email}</td>
            `;  
            tbody.appendChild(fila);
        });
        asignarListenersRadios();
    }

    function buscarPersonal() {
        const nombre = document.getElementById('buscar').value;
        const especialidad = document.getElementById('especialidad').value;
        fetch(`/buscar-personal?nombre=${encodeURIComponent(nombre)}&especialidad=${encodeURIComponent(especialidad)}`)
            .then(res => res.json())
            .then(data => actualizarTabla(data));
    }

    document.getElementById('buscar').addEventListener('input', buscarPersonal);
    document.getElementById('especialidad').addEventListener('change', buscarPersonal);

document.getElementById('eliminar-personal').addEventListener('click', function(){
    if(personalSeleccionado){
        window.location.href = `/eliminarpersonal/${personalSeleccionado}`;
    }
});

document.getElementById('editar-personal').addEventListener('click', function(){
    if(personalSeleccionado){
        window.location.href = `/editarpersonal/${personalSeleccionado}`;
    }
});

</script>
    </div>
    
<%- include('../footer.ejs') %>
</body>
</html>
