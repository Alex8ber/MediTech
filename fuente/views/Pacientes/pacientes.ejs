<%- include('../header') %>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pacientes</title>
    <link rel="stylesheet" href="/css/estilos1.css">
    <link rel="stylesheet" href="/css/doctores.css">

</head>
<body>
    <main>        
        <div class="titulo">Pacientes</div>
        <div class="busqueda">
            <div>
                <label for="buscar">Buscar paciente</label>
                <input type="text" id="buscar_paciente" placeholder="Nombre, cédula, email...">
            </div>
            <div>
                <label for="buscar">Buscar patologia</label>
                <input type="text" id="buscar_patologia" placeholder="Buscar Patologia">
            </div>
        </div>

        <div class="tabla-section">
            <div class="tabla-titulo">Pacientes registrados</div>
            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Cédula</th>
                        <th>Edad</th>
                        <th>Genero</th>
                        <th>Patologia</th>
                        <th>Teléfono</th>
                        <th>Fecha de Nacimiento</th>
                        <th>Dirección</th>
                    </tr>
                </thead>
                <tbody id="tabla-pacientes">
                   <% pacientes.forEach(paciente => { %>
                        <tr>
                            <td><%= paciente.Nombre %></td>
                            <td><%= paciente.Apellido %></td>
                            <td><%= paciente.Cedula %></td>
                            <td><%= paciente.Edad %></td>
                            <td><%= paciente.Genero %></td>
                            <td><%= paciente.Patologia %></td>
                            <td><%= paciente.Telefono %></td>
                            <td><%= paciente.FechaNacimiento %></td>
                            <td><%= paciente.Direccion %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
            <button class="nuevo-paciente" style="margin-left:20px;">Nuevo Paciente</button>
            <button class="editar-paciente" style="margin-left:20px;">Editar Paciente</button>
        </div>
    </main>
    <script>
        function actualizarTabla(pacientes) {
    const tbody = document.getElementById('tabla-pacientes');
    tbody.innerHTML = '';
    pacientes.forEach(paciente => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
            <td>${paciente.Nombre}</td>
            <td>${paciente.Apellido}</td>
            <td>${paciente.Cedula}</td>
            <td>${paciente.Edad}</td>
            <td>${paciente.Genero}</td>
            <td>${paciente.Patologia}</td>
            <td>${paciente.Telefono}</td>
            <td>${paciente.FechaNacimiento}</td>
            <td>${paciente.Direccion}</td>
        `;
        tbody.appendChild(fila);
    });
}

function getFiltros() {
    return {
        q: document.getElementById('buscar_paciente').value,
        patologia: document.getElementById('buscar_patologia').value
    };
}

function buscarPacientes() {
    const filtros = getFiltros();
    const params = new URLSearchParams(filtros).toString();
    fetch(`/buscar-pacientes?${params}`)
        .then(res => res.json())
        .then(data => actualizarTabla(data));
}

document.getElementById('buscar_paciente').addEventListener('input', buscarPacientes);
document.getElementById('buscar_patologia').addEventListener('input', buscarPacientes);
</script>
</body>
</html>
