<%- include('../header') %>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pacientes</title>
    <link rel="stylesheet" href="/css/pacientes.css">

</head>
<body>
    <main>        
       
        <div class="busqueda">
            <div>
                <label for="buscar_paciente">Buscar paciente por inicial</label>
                <select name="" id="" class="select">
                    <option value="">Seleccione la inicial del paciente</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="H">H</option>
                    <option value="I">I</option>
                    <option value="J">J</option>
                    <option value="K">K</option>
                    <option value="L">L</option>
                    <option value="M">M</option>
                    <option value="N">N</option>
                    <option value="Ñ">Ñ</option>
                    <option value="O">O</option>
                    <option value="P">P</option>
                    <option value="Q">Q</option>
                    <option value="R">R</option>
                    <option value="S">S</option>
                    <option value="T">T</option>
                    <option value="U">U</option>
                    <option value="V">V</option>
                    <option value="W">W</option>
                    <option value="X">X</option>
                    <option value="Y">Y</option>
                    <option value="Z">Z</option>

                </select>
                
                <label for="">Buscar por genero</label>
                <select name="" id="">
                    <option value="">Seleccione el genero</option>
                    <option value="">Maculino</option>
                    <option value="">Femenino</option>
                </select>

            </div>
            <div>
                <label for="buscar_patologia">Buscar patología</label>
                <select name="" id="">
                    <option value="">Seleccione tipo de patología</option>
                </select>

                <label for="">Tipo de Sangre</label>
                <select name="" id="">
                    <option value="">Seleccione el tipo de sangre</option>
                    <option value="">A+</option>
                    <option value="">A-</option>
                    <option value="">B+</option>
                    <option value="">B-</option>
                    <option value="">O+</option>
                    <option value="">O-</option>
                    <option value="">AB+</option>
                    <option value="">AB-</option>
                </select>
                
            </div>
        </div>
        <div class="pacientes-container">
                <div class="tabla-titulo">Pacientes registrados</div>
                <div class="tabla-section">
            <table>
                <thead>
                    <tr>
                        <th></th>
                        <th>Nombres</th>
                        <th>Apellidos</th>
                        <th>Cédula</th>
                        <th>Edad</th>
                        <th>Genero</th>
                        <th>Patologia</th>
                        <th>Teléfono</th>
                        <th>Email</th>
                        <th>Ocupación</th>
                        <th>Estado Civil</th>
                        <th>Condición</th>
                        <th>Tipo de Sangre</th>
                        <th>Dirección</th>
                    </tr>
                </thead>
                <tbody id="tabla-pacientes">
                   <% pacientes.forEach(paciente => { %>
                        <tr>
                            <td><input type="radio" name="paciente_id" value="<%= paciente.id %>"></td>
                            <td><%= paciente.Nombre %></td>
                            <td><%= paciente.Apellido %></td>
                            <td><%= paciente.Cedula %></td>
                            <td><%= paciente.Edad %></td>
                            <td><%= paciente.Genero %></td>
                            <td><%= paciente.Patologia %></td>
                            <td><%= paciente.Telefono %></td>
                            <td><%= paciente.Email %></td>
                            <td><%= paciente.Ocupacion %></td>
                            <td><%= paciente["Estado Civil"] %></td>
                            <td><%= paciente.Condicion %></td>
                            <td><%= paciente["Tipo de Sangre"] %></td>
                            <td><%= paciente.Direccion %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
            <button style="margin-left:20px;"   id="nuevo-paciente" class="nuevo-paciente" onclick="window.location.href='/registrarpaciente'"> Nuevo Paciente </button>
            <button style="margin-left:20px;" id="editar-paciente" class="editar-paciente" disabled> Editar Paciente </button>
            <button style="margin-left:20px;" id="eliminar-paciente" class="eliminar-paciente" disabled>Eliminar Paciente</button>
            <button style="margin-left:20px;" id="nuevo-historial" class="nuevo-historial"  disabled>Historial</button>
        </div>
    </main>
    <script>

        // Asignar el paciente seleccionado a una variable global
        let pacienteSeleccionado = null;
        // Asignar listeners a los radios de pacientes
        function asignarListenersRadios() {
            const radios = document.getElementsByName('paciente_id');
            radios.forEach(radio => {
                radio.addEventListener('change', function() {
                    pacienteSeleccionado = this.value;
                    document.getElementById('editar-paciente').disabled = false;
                    document.getElementById('nuevo-historial').disabled = false;
                    document.getElementById('eliminar-paciente').disabled = false;
                });
            });
        }
        // Inicializar los listeners de los radios al cargar la página
        asignarListenersRadios();

    function actualizarTabla(pacientes) {
    const tbody = document.getElementById('tabla-pacientes');
    tbody.innerHTML = '';
    pacientes.forEach(paciente => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
            <td><input type="radio" name="paciente_id" value="${paciente.id}"></td>
            <td>${paciente.Nombre}</td>
            <td>${paciente.Apellido}</td>
            <td>${paciente.Cedula}</td>
            <td>${paciente.Edad}</td>
            <td>${paciente.Genero}</td>
            <td>${paciente.Patologia}</td>
            <td>${paciente.Telefono}</td>
            <td>${paciente.Email}</td>
            <td>${paciente.Ocupacion}</td>
            <td>${paciente["Estado Civil"]}</td>
            <td>${paciente.Condicion}</td>
            <td>${paciente["Tipo de Sangre"]}</td>
            <td>${paciente.Direccion}</td>
        `;
        tbody.appendChild(fila);
    });
    asignarListenersRadios();
}

// Redirigir a los formularios correspondientes por Id
document.getElementById('nuevo-historial').addEventListener('click', function() {
    if (pacienteSeleccionado) {
        window.location.href = `/registrarhistorial/${pacienteSeleccionado}`;
    } 
});
document.getElementById('editar-paciente').addEventListener('click', function(){
    if(pacienteSeleccionado){
        window.location.href = `/editarpaciente/${pacienteSeleccionado}`;
    }
});
document.getElementById('eliminar-paciente').addEventListener('click', function(){
    if(pacienteSeleccionado){
        window.location.href = `/eliminarpaciente/${pacienteSeleccionado}`;
    }
});

</script>

<%- include('../footer.ejs') %>
</body>
</html>
