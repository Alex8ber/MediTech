<%- include('header') %>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>reportes</title>
    <link rel="stylesheet" href="/css/reportes.css">
</head>
<body>
    <div class="main-content">
    <div class="tabs">
        <button class="tab active" data-tab="general">General</button>
        <button class="tab" data-tab="pacientes">Pacientes</button>
        <button class="tab" data-tab="doctores">Doctores</button>
        <button class="tab" data-tab="personal">Personal</button>
        <button class="tab" data-tab="citas">Citas</button>
    </div>
    <div class="section-actions" id="section-actions">
        </div>
    <div class="cards-container" id="cards-container">
        </div>
    <script>
const citasTotales = `<%= citasTotales %>`;
const citasHoy = `<%= citasHoy %>`;
const citasMes = `<%= citasMes %>`;
const citasAnno = `<%= citasAnno %>`;
const totalPacientesval = `<%= pacientes %>`;
const totalDoctores = `<%= doctores %>`;
const doctoresPorEspecialidad = <%- JSON.stringify(doctoresPorEspecialidad) %>;
const personalNoDoctores = <%- JSON.stringify(personalNoDoctores) %>;
const pacientesPorCondicion = <%- JSON.stringify(pacientesPorCondicion) %>;

function pluralizar(tipo) {
    if (tipo.endsWith('or')) return tipo + 'es';
    if (tipo.endsWith('a')) return tipo + 's';
    if (tipo.endsWith('e')) return tipo + 's';
    return tipo + 's';
}

const totalPersonalNoDoctores = personalNoDoctores.reduce((acc, curr) => acc + Number(curr.cantidad), 0);

const data = {
    general: [
        { label: "Totales registrados", title: "Pacientes", value: totalPacientesval.toString(), tooltip: "Cantidad total de pacientes registrados" },
        { label: "Totales registrados", title: "Doctores", value: totalDoctores, tooltip: "Numero total de Doctores" },
        { label: "Totales registrados", title: "Personal", value: totalPersonalNoDoctores, tooltip: "Numero total de Personal que no son doctores" },
    ],
    pacientes: [
        { label: "Totales registrados", title: "Pacientes", value: totalPacientesval.toString(), tooltip: "Cantidad total de pacientes registrados" },
        ...(Array.isArray(pacientesPorCondicion) ? pacientesPorCondicion.map(e => ({
            label: "Condición",
            title: e.condicion,
            value: e.cantidad,
            tooltip: `Pacientes en condición ${e.condicion}`
        })) : [])
    ],
    doctores: [
        { label: "Totales registrados", title: "Doctores", value: totalDoctores, tooltip: "Cantidad total de doctores" },
        ...(Array.isArray(doctoresPorEspecialidad) ? doctoresPorEspecialidad.map(e => ({
            label: "Especialidad",
            title: e.especialidad,
            value: e.cantidad,
            tooltip: `Doctores en ${e.especialidad}`
        })) : [])
    ],
    personal: [
        { label: "Totales registrados", title: "Personal", value: totalPersonalNoDoctores, tooltip: "Total de Personal que no son doctores" },
        ...(Array.isArray(personalNoDoctores) ? personalNoDoctores.map(e => ({
            label: ` Total de `,
            title: `${pluralizar(e.tipo)}`,
            value: e.cantidad,
            tooltip: `Cantidad de ${pluralizar(e.tipo)}`
        })) : [])
    ],
    citas: [
        { label: "Citas", title: "Totales", value: citasTotales, tooltip: "Citas registradas en total" },
        { label: "Citas", title: "Hoy", value: citasHoy, tooltip: "Citas para hoy" },
        { label: "Citas", title: "Este mes", value: citasMes, tooltip: "Citas para este mes" },
        { label: "Citas", title: "Este año", value: citasAnno, tooltip: "Citas para este año" }
    ],
};

function descargarReporte(tab) {
    alert('Descargar reporte de: ' + tab);
}

function renderDownloadButton(tab) {
            const section = document.getElementById('section-actions');
            section.innerHTML = `
                <button class="download-btn" onclick="window.location.href='/pdf${tab}'">
                    <svg viewBox="0 0 20 20"><path d="M10 2a1 1 0 0 1 1 1v8.586l2.293-2.293a1 1 0 1 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4A1 1 0 1 1 5.707 9.293L8 11.586V3a1 1 0 0 1 1-1zm-7 13a1 1 0 0 1 1-1h12a1 1 0 1 1 0 2H4a1 1 0 0 1-1-1z"/></svg>
                    Descargar Reporte
                </button>
            `;
        }

function renderCards(tab) {
    const container = document.getElementById('cards-container');
    container.innerHTML = '';
    if (!data[tab]) return;
    data[tab].forEach(card => {
        container.innerHTML += `
            <div class="card" title="${card.tooltip || ''}">
                <div class="icon-circle"></div>
                <div class="label">${card.label}</div>
                <div class="title">${card.title}</div>
                <div class="value">${card.value !== undefined ? card.value : ''}</div>
            </div>
        `;
    });
}

// Inicializar con la pestaña general
renderDownloadButton('general');
renderCards('general');

// Manejar el cambio de pestañas
document.querySelectorAll('.tab').forEach(tabBtn => {
    tabBtn.addEventListener('click', function() {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        const tab = this.getAttribute('data-tab');
        renderDownloadButton(tab);
        renderCards(tab);
    });
});
</script>
     </div>
    <%- include('footer.ejs') %>
</body>
</html>